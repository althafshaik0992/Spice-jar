<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Gift Cards • The Spice Jar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <link rel="icon" type="image/svg+xml"
          href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='16' fill='%23218838'/%3E%3Cpath fill='%23fff' d='M10 21c0-4.2 5-4.2 5-8 0-1.4-.8-2.6-2-3.5 3 .3 5 2.2 5 4.7 0 3.6-4 4.6-4 7.8h6v1.5H10V21z'/%3E%3C/svg%3E">

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

    <style>
        :root{
            --green:#218838;
            --accent:#b7410e;
            --bg:#f6fbf6;
            --card:#fff;
            --ring:rgba(33,136,56,.12);
        }

        *{box-sizing:border-box}

        body{
            margin:0;
            font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;
            background:var(--bg);
            color:#111;
        }

        /* Navbar */
        .navbar{
            background:#fff;
            padding:6px 6%;
            box-shadow:0 2px 6px rgba(0,0,0,.05);
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:16px;
            position:sticky;
            top:0;
            z-index:1000;
            height:60px;
        }

        .brand-logo{
            display:flex;
            align-items:center;
            gap:8px;
            text-decoration:none;
            color:var(--green);
            font-weight:700;
            font-size:20px;
        }

        .brand-logo video{
            width:36px;
            height:auto;
            border-radius:4px;
        }

        .nav-links{
            display:flex;
            align-items:center;
            gap:18px;
        }

        .nav-links a{
            text-decoration:none;
            color:#333;
            font-weight:500;
            font-size:15px;
        }

        .nav-links a:hover{
            color:var(--green);
        }

        /* Navbar search */
        .nav-search{
            flex:1;
            max-width:520px;
            display:flex;
            align-items:center;
            gap:8px;
        }

        .nav-search input{
            width:100%;
            padding:10px 12px;
            border:1px solid #ddd;
            border-radius:999px;
            background:#fff;
            font-size:14px;
            outline:none;
        }

        .nav-search button{
            border:none;
            border-radius:999px;
            padding:9px 12px;
            background:var(--green);
            color:#fff;
            cursor:pointer;
        }

        .nav-search button:hover{
            background:var(--accent);
        }

        .cart-icon-container{
            position:relative;
            display:inline-block;
        }

        .cart-count-badge{
            position:absolute;
            top:-8px;
            right:-8px;
            background:var(--accent);
            color:#fff;
            border-radius:50%;
            min-width:20px;
            height:20px;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:12px;
            font-weight:700;
        }

        /* Dropdowns */
        .dropdown{position:relative}

        .dropdown-toggle{
            display:flex;
            align-items:center;
            gap:6px;
            background:none;
            border:none;
            cursor:pointer;
            font-size:15px;
            color:#333;
        }

        .dropdown-menu{
            display:none;
            position:absolute;
            right:0;
            top:100%;
            background:#fff;
            box-shadow:0 4px 10px rgba(0,0,0,.1);
            border-radius:6px;
            overflow:hidden;
            min-width:180px;
            z-index:1001;
        }

        .dropdown-menu a,
        .dropdown-menu span{
            display:block;
            padding:10px 16px;
            text-decoration:none;
            color:#333;
            white-space:nowrap;
            font-size:14px;
        }

        .dropdown-menu a:hover{
            background:#f4f4f4;
        }

        /* Page layout */
        .wrap{
            max-width:1100px;
            margin:24px auto;
            padding:0 6%;
        }

        h1{
            font-size:28px;
            margin:6px 0 16px;
        }

        .grid{
            display:grid;
            grid-template-columns:2fr 1fr;
            gap:16px;
        }

        @media (max-width:960px){
            .grid{grid-template-columns:1fr}
        }

        .card{
            background:var(--card);
            border-radius:16px;
            box-shadow:0 10px 24px rgba(0,0,0,.06);
            padding:18px;
        }

        .btn{
            display:inline-flex;
            gap:8px;
            align-items:center;
            background:var(--green);
            color:#fff;
            border:0;
            border-radius:12px;
            padding:10px 14px;
            font-weight:700;
            text-decoration:none;
            cursor:pointer;
            font-size:14px;
        }

        .btn:hover{
            background:var(--accent);
        }

        .btn-ghost{
            background:#f6f9f6;
            color:#14532d;
            border:1px solid #e7eee7;
        }

        .muted{
            color:#6b7280;
            font-size:14px;
        }

        .chip{
            border:1px solid #e7eee7;
            background:#f6fbf6;
            border-radius:999px;
            padding:4px 10px;
            font-size:12px;
        }

        /* Cards grid */
        .cards-grid{
            display:grid;
            grid-template-columns:repeat(3,minmax(240px,1fr));
            gap:16px;
        }

        @media (max-width:1100px){
            .cards-grid{grid-template-columns:repeat(2,1fr)}
        }

        @media (max-width:640px){
            .cards-grid{grid-template-columns:1fr}
        }

        .gc{
            position:relative;
            border-radius:16px;
            padding:16px;
            border:1px solid #eef2ef;
            background:#fff;
        }

        .gc .code{
            font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            letter-spacing:.5px;
        }

        /* Progress bar */
        .bar{
            height:8px;
            background:#eef2ef;
            border-radius:999px;
            overflow:hidden;
        }

        .bar > span{
            display:block;
            height:100%;
            background:linear-gradient(90deg,#22c55e,#16a34a);
            border-radius:999px;
        }

        /* Activity */
        details summary{
            list-style:none;
            cursor:pointer;
            display:flex;
            align-items:center;
            gap:8px;
            font-weight:700;
            color:#0f172a;
        }

        details summary::-webkit-details-marker{display:none}

        /* Empty + toast */
        .empty{
            padding:28px;
            text-align:center;
            border:1px dashed #cfead6;
            border-radius:16px;
            background:#fbfffb;
        }

        .toast{
            padding:12px 14px;
            border-radius:12px;
            font-weight:700;
            margin-bottom:12px;
            font-size:14px;
        }

        .toast.ok{
            background:#e9f7ee;
            color:#14532d;
            border:1px solid #cfead6;
        }

        .toast.err{
            background:#fdeaea;
            color:#7f1d1d;
            border:1px solid #f5c2c2;
        }

        /* Redeem */
        .redeem-row{
            display:flex;
            gap:8px;
        }

        .redeem-row input{
            flex:1;
            border:1px solid #e1e5e1;
            border-radius:12px;
            padding:10px 12px;
            font-size:14px;
        }

        /* Footer */
        .site-footer{
            background:#222;
            color:#ccc;
            padding:40px 6%;
            margin-top:40px;
        }

        .footer-container{
            display:flex;
            flex-wrap:wrap;
            justify-content:space-between;
            gap:30px;
            margin-bottom:30px;
        }

        .footer-column{
            flex:1;
            min-width:220px;
        }

        .footer-column h3{
            color:#fff;
            margin-bottom:15px;
            font-weight:600;
            border-bottom:2px solid var(--green);
            padding-bottom:8px;
            display:inline-block;
        }

        .footer-column p{
            line-height:1.6;
            font-size:14px;
        }

        .footer-column ul{
            list-style:none;
            padding:0;
            margin:0;
        }

        .footer-column ul li a{
            text-decoration:none;
            color:#ccc;
            display:block;
            padding:5px 0;
            font-size:14px;
            transition:color 0.3s;
        }

        .footer-column ul li a:hover{
            color:#fff;
        }

        .social-links a{
            color:#ccc;
            text-decoration:none;
            font-size:20px;
            margin-right:15px;
            transition:color 0.3s;
        }

        .social-links a:hover{
            color:var(--green);
        }

        .footer-bottom{
            text-align:center;
            padding-top:20px;
            border-top:1px solid #444;
            font-size:14px;
        }

        @media (max-width: 768px){
            .footer-container{
                flex-direction:column;
                text-align:center;
            }
            .footer-column{margin-bottom:20px;}
        }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
    <a href="/" class="brand-logo">
        <video src="/images/Spice-Jar.mp4" autoplay muted loop playsinline></video>
        <span>SpiceJar</span>
    </a>

    <form class="nav-search" role="search" onsubmit="return false;">
        <input id="nav-q" type="search" placeholder="Search spices…" aria-label="Search" th:value="${q}">
        <button id="nav-search-btn" type="button" aria-label="Search">
            <i class="fa-solid fa-magnifying-glass"></i>
        </button>
    </form>

    <div class="nav-links">
        <a th:href="@{/menu}">Menu</a>
        <a th:href="@{/about}">About Us</a>

        <a class="nav-link" th:href="@{/cart/view}">
            <div class="cart-icon-container" aria-live="polite" aria-label="Cart items">
                <i class="fas fa-shopping-cart" style="font-size:24px"></i>
                <span class="cart-count-badge" id="lblCartCount" th:text="${cartCount}">0</span>
            </div>
        </a>

        <a th:href="@{/contact}">Contact Us</a>

        <!-- Account -->
        <div class="dropdown">
            <button class="dropdown-toggle">
                <i class="fas fa-user"></i>
                <span th:text="${session.USER != null ? session.USER.firstName : 'Account'}">Account</span>
            </button>
            <div class="dropdown-menu">
                <a th:if="${session.USER == null}" th:href="@{/login}">Login</a>
                <a th:if="${session.USER == null}" th:href="@{/register}">Register</a>

                <span th:if="${session.USER != null}">
                    Welcome, <strong th:text="${session.USER.firstName}">User</strong>
                </span>
                <a th:if="${session.USER != null}" th:href="@{/account}">Your Account</a>
                <a th:if="${session.USER != null}" th:href="@{/orders}">My Orders</a>
                <a th:if="${session.USER != null}" th:href="@{/logout}">Logout</a>
            </div>
        </div>
    </div>
</nav>

<div class="wrap">
    <h1>Gift Cards</h1>

    <!-- Flash message -->
    <div th:if="${flashMsg != null}"
         th:class="'toast ' + (${flashOk} ? 'ok' : 'err')"
         th:text="${flashMsg}">
        Message
    </div>

    <div class="grid">
        <!-- Left: cards & content -->
        <div>
            <!-- Summary -->
            <div class="card"
                 style="display:flex;justify-content:space-between;gap:16px;align-items:center;margin-bottom:16px">
                <div>
                    <div class="muted" style="font-weight:700">Total Gift Card Balance</div>
                    <div style="font-size:28px;font-weight:800;margin-top:4px">
                        $ <span th:text="${#numbers.formatDecimal(totalBalance,1,'COMMA',2,'POINT')}">0.00</span>
                    </div>
                    <div class="muted" style="margin-top:6px">
                        <span class="chip">
                            <i class="fa-solid fa-credit-card"></i>&nbsp;
                            <span th:text="${cardsCount}">0</span> card(s)
                        </span>
                    </div>
                </div>
                <div style="display:flex;gap:8px;flex-wrap:wrap">
                    <a class="btn btn-ghost" th:href="@{/account}">
                        <i class="fa-solid fa-circle-arrow-left"></i> Back to Account
                    </a>
                    <a class="btn" th:href="@{/gift-cards/buy}">
                        <i class="fa-solid fa-gift"></i> Buy a Gift Card
                    </a>
                </div>
            </div>

            <!-- Empty state -->
            <div class="empty" th:if="${cards == null or #lists.isEmpty(cards)}">
                <i class="fa-solid fa-gift" style="font-size:28px;color:#218838"></i>
                <p style="margin:8px 0 2px;font-weight:800">No gift cards yet</p>
                <p class="muted" style="margin:0 0 14px">Redeem a code or purchase a gift card to see it here.</p>
                <div style="display:flex;gap:8px;justify-content:center">
                    <a class="btn" th:href="@{/gift-cards/buy}">
                        <i class="fa-solid fa-cart-shopping"></i> Buy
                    </a>
                    <a class="btn btn-ghost" href="#redeem">
                        <i class="fa-solid fa-check"></i> Redeem
                    </a>
                </div>
            </div>

            <!-- Cards grid -->
            <div class="cards-grid" th:if="${cards != null and !#lists.isEmpty(cards)}">
                <div class="gc" th:each="card : ${cards}">
                    <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start">
                        <div>
                            <div class="muted" style="font-weight:700">Code</div>
                            <div class="code" style="font-size:18px;font-weight:800"
                                 th:text="${card.code}">SJ-9K4T-AX7L
                            </div>
                        </div>
                        <div>
                            <!-- Status chip -->
                            <span class="chip"
                                  th:style="${!card.active} ? 'border-color:#f5c2c2;background:#fdeaea;color:#7f1d1d'
                                           : (card.expired ? 'border-color:#f5c2c2;background:#fdeaea;color:#7f1d1d'
                                                           : 'border-color:#cfead6;background:#e9f7ee;color:#14532d')"
                                  th:text="${!card.active} ? 'Inactive'
                                           : (card.expired ? 'Expired' : 'Active')">
                                Active
                            </span>
                        </div>
                    </div>

                    <div style="margin:12px 0 8px">
                        <div style="display:flex;justify-content:space-between">
                            <div class="muted">Balance</div>
                            <div style="font-weight:800">
                                $ <span th:text="${#numbers.formatDecimal(card.balance,1,'COMMA',2,'POINT')}">0.00</span>
                                <span class="muted">
                                    / $<span th:text="${#numbers.formatDecimal(card.originalAmount,1,'COMMA',2,'POINT')}">
                                        0.00
                                    </span>
                                </span>
                            </div>
                        </div>
                        <div class="bar" style="margin-top:6px">
                            <span th:with="pct=${(card.originalAmount != null and card.originalAmount > 0)
                                               ? (card.balance / card.originalAmount * 100) : 0}"
                                  th:style="|width:${pct}%;|"></span>
                        </div>
                    </div>

                    <div class="muted" style="display:flex;gap:12px;flex-wrap:wrap">
                        <span>
                            <i class="fa-regular fa-calendar"></i>
                            <span th:if="${card.expiresAt != null}">
                                Expires
                                <span th:text="${#temporals.format(card.expiresAt, 'MMM d, yyyy')}">
                                    Dec 31, 2025
                                </span>
                            </span>
                            <span th:if="${card.expiresAt == null}">No expiry</span>
                        </span>
                        <span>
                            <i class="fa-solid fa-receipt"></i>
                            <span th:text="${card.redemptions != null ? #lists.size(card.redemptions) : 0}">
                                0
                            </span> activity
                        </span>
                    </div>

                    <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
                        <form th:action="@{'/gift-cards/remove/' + ${card.id}}"
                              method="post"
                              onsubmit="return confirm('Remove this card from your account?');">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button class="btn btn-ghost" type="submit">
                                <i class="fa-solid fa-trash"></i> Remove
                            </button>
                        </form>

                        <button class="btn btn-ghost" type="button"
                                th:onclick="'navigator.clipboard.writeText(' + &quot;'&quot; + ${card.code} + &quot;'&quot; + '); this.innerHTML=&quot;<i class=&quot;fa-solid fa-check&quot;></i> Copied&quot;;'">
                            <i class="fa-regular fa-copy"></i> Copy code
                        </button>
                    </div>

                    <!-- Activity -->
                    <details style="margin-top:10px"
                             th:if="${card.redemptions != null and !#lists.isEmpty(card.redemptions)}">
                        <summary>
                            <i class="fa-solid fa-clock-rotate-left"></i> Activity
                        </summary>
                        <div style="margin-top:10px;display:grid;gap:8px">
                            <div class="card" style="padding:10px" th:each="r : ${card.redemptions}">
                                <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
                                    <div class="muted">
                                        <i class="fa-solid fa-cart-shopping"></i>
                                        Order #<span th:text="${r.orderId}">1234</span>
                                    </div>
                                    <div class="muted">
                                        <i class="fa-regular fa-clock"></i>
                                        <span th:text="${#temporals.format(r.createdAt, 'MMM d, yyyy h:mm a')}">
                                            Oct 10, 2025 12:33 PM
                                        </span>
                                    </div>
                                    <div style="font-weight:800">
                                        - $<span th:text="${#numbers.formatDecimal(r.amount,1,'COMMA',2,'POINT')}">
                                            0.00
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </details>
                </div>
            </div>
        </div>

        <!-- Right: Redeem -->
        <aside>
            <div id="redeem" class="card">
                <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
                    <h2 style="margin:0;font-size:18px">Redeem a Gift Card</h2>
                    <i class="fa-solid fa-gift" style="color:#218838"></i>
                </div>
                <p class="muted" style="margin:8px 0 12px">
                    Enter your gift card code to add it to your account.
                </p>

                <form th:action="@{/gift-cards/redeem}"
                      method="post"
                      class="redeem-row"
                      th:if="${session.USER != null}">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="text"
                           name="code"
                           placeholder="e.g., SJ-9K4T-AX7L"
                           minlength="8"
                           maxlength="32"
                           required
                           autocomplete="off"/>
                    <button class="btn" type="submit">
                        <i class="fa-solid fa-check"></i> Redeem
                    </button>
                </form>

                <div class="muted" th:if="${session.USER == null}" style="margin-top:8px">
                    Login to redeem a gift card.
                </div>

                <p class="muted" style="margin-top:10px">
                    <i class="fa-solid fa-shield-check"></i>
                    Codes are case-insensitive; hyphens optional.
                </p>
            </div>

            <div class="card" style="margin-top:16px">
                <h2 style="margin:0 0 8px;font-size:18px">How it works</h2>
                <ul class="muted"
                    style="margin:0 0 0 18px;padding:0;display:grid;gap:6px">
                    <li>Redeemed cards attach to your account.</li>
                    <li>At checkout, we automatically apply your balance.</li>
                    <li>Any remaining amount stays for future orders.</li>
                </ul>
            </div>
        </aside>
    </div>
</div>

<footer class="site-footer">
    <div class="footer-container">
        <div class="footer-column">
            <h3>About Spice Jar</h3>
            <p>Bringing the world's finest spices to your kitchen. Quality, aroma, and flavor guaranteed in every jar.</p>
        </div>
        <div class="footer-column">
            <h3>Quick Links</h3>
            <ul>
                <li><a th:href="@{/menu}">Menu</a></li>
                <li><a th:href="@{/about}">About Us</a></li>
                <li><a th:href="@{/contact}">Contact</a></li>
                <li><a href="#">FAQ</a></li>
            </ul>
        </div>
        <div class="footer-column">
            <h3>Connect With Us</h3>
            <div class="social-links">
                <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                <a href="#" aria-label="Pinterest"><i class="fab fa-pinterest"></i></a>
            </div>
        </div>
    </div>
    <div class="footer-bottom">
        <p>&copy; 2025 The Spice Jar. All rights reserved.</p>
    </div>
</footer>

<script>
    // simple hover dropdown
    document.addEventListener('DOMContentLoaded', function () {
        const dd = document.querySelector('.dropdown');
        if (!dd) return;
        const menu = dd.querySelector('.dropdown-menu');
        dd.addEventListener('mouseenter', () => menu.style.display = 'block');
        dd.addEventListener('mouseleave', () => menu.style.display = 'none');
    });
</script>

</body>
</html>
