<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>My Wallet • SpiceJar</title>

    <link rel="icon" type="image/svg+xml"
          href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='16' fill='%23218838'/%3E%3Cpath fill='%23fff' d='M10 21c0-4.2 5-4.2 5-8 0-1.4-.8-2.6-2-3.5 3 .3 5 2.2 5 4.7 0 3.6-4 4.6-4 7.8h6v1.5H10V21z'/%3E%3C/svg%3E">

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { background:#f6fbf6; }
        .card { border-radius:16px; border:1px solid #e5e7eb; background:#fff; }
        .chip { border-radius:999px; border:1px solid #e5e7eb; background:#fff; }
    </style>
</head>

<body class="min-h-screen text-slate-900">

<!-- Top nav -->
<header class="sticky top-0 z-30 bg-white/90 backdrop-blur border-b border-slate-200">
    <div class="max-w-6xl mx-auto px-5 h-14 flex items-center justify-between">
        <a th:href="@{/}" class="flex items-center gap-2 font-extrabold text-emerald-700">
            <span class="h-9 w-9 rounded-xl bg-emerald-600 text-white grid place-items-center">SJ</span>
            <span>SpiceJar</span>
        </a>

        <nav class="flex items-center gap-3 text-sm">
            <a th:href="@{/menu}" class="px-3 py-2 rounded-lg hover:bg-slate-100">Menu</a>
            <a th:href="@{/orders}" class="px-3 py-2 rounded-lg hover:bg-slate-100">My Orders</a>
            <a th:href="@{/account}" class="px-3 py-2 rounded-lg hover:bg-slate-100">Account</a>
            <a th:href="@{/account/wallet}" class="px-3 py-2 rounded-lg bg-emerald-600 text-white">Wallet</a>
        </nav>
    </div>
</header>

<main class="max-w-6xl mx-auto px-5 py-8 space-y-6">

    <!-- Header -->
    <section class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3">
        <div>
            <h1 class="text-2xl font-extrabold tracking-tight">Loyalty Wallet</h1>
            <p class="text-slate-600 mt-1">
                Earn points on every order and redeem them as cash discounts.
            </p>
        </div>

        <a th:href="@{/checkout}"
           class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700">
            <i class="fa-solid fa-bag-shopping"></i>
            Go to Checkout
        </a>
    </section>

    <!-- KPIs -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="card p-5">
            <div class="flex items-center justify-between">
                <div class="text-slate-600 text-sm">Current Points</div>
                <span class="chip px-3 py-1 text-xs text-emerald-700 border-emerald-200 bg-emerald-50">
                    Wallet
                </span>
            </div>

            <div class="mt-2 text-4xl font-extrabold text-emerald-700"
                 th:text="${walletPoints != null ? walletPoints : 0}">
                0
            </div>

            <div class="mt-1 text-sm text-slate-500">
                Value:
                <span class="font-semibold">
                    $<span th:text="${walletPoints != null ? walletPoints : 0}">0</span>
                </span>
            </div>
        </div>

        <div class="card p-5">
            <div class="text-slate-600 text-sm">Earn Rule</div>
            <div class="mt-2 text-xl font-bold">
                $10 spent → 1 point
            </div>
            <div class="mt-1 text-sm text-slate-500">
                Points are credited after payment success.
            </div>
        </div>

        <div class="card p-5">
            <div class="text-slate-600 text-sm">Redeem Rule</div>
            <div class="mt-2 text-xl font-bold">
                1 point = $1 discount
            </div>
            <div class="mt-1 text-sm text-slate-500">
                Redeem instantly at checkout.
            </div>
        </div>
    </section>

    <!-- Messages -->
    <div th:if="${msg}" class="card p-4 border-emerald-200 bg-emerald-50 text-emerald-800 font-semibold"
         th:text="${msg}"></div>

    <div th:if="${error}" class="card p-4 border-rose-200 bg-rose-50 text-rose-800 font-semibold"
         th:text="${error}"></div>

    <!-- Recent Activity -->
    <section class="card p-6">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-bold flex items-center gap-2">
                <i class="fa-solid fa-clock-rotate-left text-emerald-600"></i>
                Recent Activity
            </h2>
            <span class="text-sm text-slate-500">Last 10 entries</span>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full text-sm">
                <thead>
                <tr class="text-slate-600">
                    <th class="py-2 pr-4 text-left border-b">Date</th>
                    <th class="py-2 pr-4 text-left border-b">Type</th>
                    <th class="py-2 pr-4 text-left border-b">Order</th>
                    <th class="py-2 pr-4 text-left border-b">Note</th>
                    <th class="py-2 text-right border-b">Points</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="tx : ${ledger}" class="border-b">
                    <td class="py-3 pr-4"
                        th:text="${#temporals.format(tx.createdAt,'MMM d, yyyy h:mm a')}"></td>

                    <td class="py-3 pr-4">
                        <span class="chip px-2 py-1 text-xs"
                              th:classappend="${tx.type.name() == 'EARN'} ?
                              ' border-emerald-200 bg-emerald-50 text-emerald-800' :
                              ' border-amber-200 bg-amber-50 text-amber-800'"
                              th:text="${tx.type}">
                        </span>
                    </td>

                    <td class="py-3 pr-4">
                        <span th:if="${tx.orderId != null}">
                            #<a th:href="@{/orders/{id}(id=${tx.orderId})}"
                                class="text-emerald-700 hover:underline"
                                th:text="${tx.orderId}"></a>
                        </span>
                        <span th:if="${tx.orderId == null}" class="text-slate-400">—</span>
                    </td>

                    <td class="py-3 pr-4 text-slate-600" th:text="${tx.note}"></td>

                    <td class="py-3 text-right font-extrabold"
                        th:classappend="${tx.points >= 0} ? ' text-emerald-700' : ' text-rose-600'"
                        th:text="${tx.points >= 0 ? '+' + tx.points : tx.points}">
                    </td>
                </tr>

                <tr th:if="${#lists.isEmpty(ledger)}">
                    <td colspan="5" class="py-8 text-center text-slate-500">
                        No wallet activity yet. Place your first order to start earning!
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- Tips -->
    <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="card p-5">
            <h3 class="font-bold mb-2">
                <i class="fa-solid fa-lightbulb text-amber-500"></i>
                Tips
            </h3>
            <ul class="text-sm text-slate-600 list-disc pl-5 space-y-1">
                <li>Use points on larger orders to save more.</li>
                <li>Points apply before tax and shipping.</li>
                <li>Refunds may reverse earned points.</li>
            </ul>
        </div>

        <div class="card p-5">
            <h3 class="font-bold mb-2">
                <i class="fa-solid fa-headset text-emerald-600"></i>
                Need Help?
            </h3>
            <p class="text-sm text-slate-600">
                If something looks wrong, contact support with your order number.
            </p>
            <a th:href="@{/contact}"
               class="inline-flex items-center gap-2 mt-3 px-4 py-2 rounded-xl border hover:bg-slate-50">
                Contact Support
            </a>
        </div>
    </section>

</main>

<footer class="py-10 text-center text-sm text-slate-500">
    © <span th:text="${#calendars.format(#calendars.createNow(),'yyyy')}"></span> SpiceJar
</footer>

</body>
</html>
