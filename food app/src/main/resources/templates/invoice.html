<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title th:text="|Invoice #${order.confirmationNumber}|">Invoice</title>

    <style>
        body{
            font-family:Arial,Helvetica,sans-serif;
            color:#111;
            margin:0;
        }
        .wrap{
            max-width:800px;
            margin:24px auto;
            padding:0 24px;
        }

        .hdr{
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin:18px 0;
            gap:12px;
            flex-wrap:wrap;
        }
        .brand{
            font-weight:800;
            font-size:20px;
            color:#16a34a;
        }
        .hdr-right{
            display:flex;
            align-items:center;
            gap:10px;
            flex-wrap:wrap;
            justify-content:flex-end;
        }

        .btn{
            display:inline-flex;
            align-items:center;
            gap:8px;
            padding:10px 14px;
            border-radius:999px;
            font-size:13px;
            font-weight:700;
            text-decoration:none;
            cursor:pointer;
            border:1px solid transparent;
            line-height:1;
        }
        .btn-primary{
            background:#16a34a;
            color:#fff;
        }
        .btn-primary:hover{ background:#15803d; }

        .btn-secondary{
            background:#fff;
            color:#111;
            border-color:#e5e7eb;
        }
        .btn-secondary:hover{ background:#f9fafb; }

        .box{
            border:1px solid #e5e7eb;
            border-radius:10px;
            padding:14px;
            margin-top:10px;
        }
        h1{
            font-size:22px;
            margin:0 0 4px;
        }
        table{
            width:100%;
            border-collapse:collapse;
            margin-top:14px;
        }
        th,td{
            padding:10px;
            border-bottom:1px solid #eee;
            text-align:left;
            font-size:14px;
        }
        thead th{ background:#f7faf7; }

        .totals{ margin-top:14px; }
        .row{
            display:flex;
            justify-content:space-between;
            padding:6px 0;
        }
        .row.total{
            font-weight:800;
            font-size:16px;
            border-top:1px dashed #ddd;
            margin-top:6px;
            padding-top:10px;
        }

        .muted{
            color:#64748b;
            font-size:12px;
            margin-top:18px;
        }

        @media print{
            .no-print{ display:none !important; }
            .wrap{ margin:0; padding:0 12px; }
        }
    </style>
</head>

<body>
<div class="wrap">

    <div class="hdr">
        <div class="brand">The Spice Jar</div>

        <div class="hdr-right">
            <div>
                Invoice #
                <span th:text="${order.confirmationNumber}">123</span>
            </div>

            <!-- âœ… DOWNLOAD PDF -->
            <a class="btn btn-primary no-print"
               th:href="@{/orders/{id}/invoice.pdf(id=${order.id})}">
                â¬‡ Download PDF
            </a>

            <!-- âœ… PRINT -->
            <button class="btn btn-secondary no-print" type="button" onclick="window.print()">
                ðŸ–¨ Print
            </button>
        </div>
    </div>

    <div class="box">
        <h1>Billing Details</h1>

        <div>
            <strong>Name:</strong>
            <span th:text="${order.customerName}">Jane Doe</span>
        </div>
        <div>
            <strong>Email:</strong>
            <span th:text="${order.email}">jane@example.com</span>
        </div>
        <div>
            <strong>Phone:</strong>
            <span th:text="${order.phone}">555-123-4567</span>
        </div>

        <div style="margin-top:6px"><strong>Address:</strong></div>
        <div th:text="${order.street}">123 Main St</div>
        <div>
            <span th:text="${order.city}">Anytown</span>,
            <span th:text="${order.state}">CA</span>
            <span th:text="${order.zip}">12345</span>
        </div>
        <div th:text="${order.country}">USA</div>

        <div style="margin-top:8px;">
            <strong>Date:</strong>

            <!-- âœ… SAFE DATE: works when createdAt is LocalDateTime/Instant/Date, and won't crash if null -->
            <span th:text="${order.createdAt != null ? #temporals.format(order.createdAt,'MMM d, yyyy h:mm a') : 'â€”'}">
                Sep 24, 2025
            </span>
        </div>
    </div>

    <table>
        <thead>
        <tr>
            <th>Item</th>
            <th style="width:70px;">Qty</th>
            <th style="width:110px;">Unit Price</th>
            <th style="width:130px;">Line Total</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="it : ${order.items}">
            <td th:text="${it.productName}">Spice Name</td>
            <td th:text="${it.quantity}">1</td>

            <td th:text="${'$' + #numbers.formatDecimal(it.price,1,'COMMA',2,'POINT')}">$0.00</td>

            <!-- âœ… Prefer it.lineTotal from backend (recommended) -->
            <td th:text="${it.lineTotal != null ? ('$' + #numbers.formatDecimal(it.lineTotal,1,'COMMA',2,'POINT')) : 'â€”'}">$0.00</td>
        </tr>
        </tbody>
    </table>

    <div class="totals">
        <div class="row">
            <div>Subtotal</div>
            <div th:text="${'$' + #numbers.formatDecimal(order.subtotal,1,'COMMA',2,'POINT')}">$0.00</div>
        </div>
        <div class="row">
            <div>Tax</div>
            <div th:text="${'$' + #numbers.formatDecimal(order.tax,1,'COMMA',2,'POINT')}">$0.00</div>
        </div>
        <div class="row total">
            <div>Total</div>
            <div th:text="${'$' + #numbers.formatDecimal(order.grandTotal,1,'COMMA',2,'POINT')}">$0.00</div>
        </div>
    </div>

    <div class="muted">
        Thank you for shopping with The Spice Jar.
    </div>
</div>
</body>
</html>
