<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="utf-8">
    <title>Cart ‚Ä¢ The Spice Jar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml"
          href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='16' fill='%23218838'/%3E%3Cpath fill='%23fff' d='M10 21c0-4.2 5-4.2 5-8 0-1.4-.8-2.6-2-3.5 3 .3 5 2.2 5 4.7 0 3.6-4 4.6-4 7.8h6v1.5H10V21z'/%3E%3C/svg%3E">

    <!-- Icons -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --green:#218838;
            --accent:#b7410e;
            --dark:#111827;
            --bg:#f5faf6;
            --ring:rgba(15,23,42,.08);
        }

        * { box-sizing:border-box; }

        body {
            font-family:"Inter", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial;
            margin:0;
            background:radial-gradient(circle at top left, #f1fdf3 0, #f5faf6 40%, #f9fafb 100%);
            color:#222;
        }

        a { color:inherit; }

        /* Navbar */
        .navbar {
            background:rgba(255,255,255,0.96);
            backdrop-filter:blur(8px);
            padding:8px 6%;
            box-shadow:0 2px 8px rgba(15,23,42,.06);
            display:flex;
            justify-content:space-between;
            align-items:center;
            position:sticky;
            top:0;
            z-index:1000;
            height:64px;
            gap:14px;
        }

        .brand-logo {
            display:flex;
            align-items:center;
            gap:8px;
            text-decoration:none;
            color:var(--green);
            font-weight:700;
            font-size:20px;
            letter-spacing:.02em;
        }

        .brand-logo video {
            width:36px;
            height:36px;
            border-radius:8px;
            object-fit:cover;
            box-shadow:0 4px 12px rgba(0,0,0,0.15);
        }

        .nav-links {
            display:flex;
            align-items:center;
            gap:18px;
            flex-wrap:wrap;
        }

        .nav-links a {
            text-decoration:none;
            color:#374151;
            font-weight:500;
            font-size:14px;
            position:relative;
            padding:4px 0;
        }

        .nav-links a::after {
            content:"";
            position:absolute;
            left:0;
            bottom:-3px;
            width:0;
            height:2px;
            background:var(--green);
            border-radius:999px;
            transition:width .18s ease;
        }

        .nav-links a:hover::after {
            width:100%;
        }

        /* Navbar search */
        .nav-search {
            flex:1;
            max-width:520px;
            display:flex;
            align-items:center;
            gap:8px;
        }

        .nav-search input {
            width:100%;
            padding:8px 12px;
            border:1px solid #d1d5db;
            border-radius:999px;
            background:#fff;
            font-size:14px;
            outline:none;
        }

        .nav-search input:focus {
            border-color:var(--green);
            box-shadow:0 0 0 2px rgba(34,197,94,0.2);
        }

        .nav-search button {
            border:none;
            border-radius:999px;
            padding:8px 11px;
            background:var(--green);
            color:#fff;
            cursor:pointer;
            display:flex;
            align-items:center;
            justify-content:center;
        }

        .nav-search button:hover {
            background:var(--accent);
        }

        /* Cart icon */
        .cart-icon-container {
            position:relative;
            display:inline-flex;
            align-items:center;
            justify-content:center;
        }

        .cart-count-badge {
            position:absolute;
            top:-6px;
            right:-10px;
            background:var(--accent);
            color:#fff;
            border-radius:999px;
            min-width:20px;
            height:18px;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:11px;
            font-weight:700;
            padding:1px 7px;
            box-shadow:0 0 0 2px #fff;
            line-height:1;
        }

        /* Dropdown */
        .dropdown {
            position:relative;
        }

        .dropdown-toggle {
            background:none;
            border:none;
            cursor:pointer;
            font-size:14px;
            color:#111827;
            display:flex;
            align-items:center;
            gap:6px;
            padding:6px 10px;
            border-radius:999px;
            font-weight:700;
            transition:background .15s ease, box-shadow .15s ease;
        }

        .dropdown-toggle:hover {
            background:#f3f4f6;
            box-shadow:0 0 0 1px rgba(148,163,184,0.3);
        }

        .dropdown-menu {
            display:none;
            position:absolute;
            right:0;
            top:calc(100% + 8px);
            background:#fff;
            box-shadow:0 10px 28px rgba(15,23,42,0.18);
            border-radius:12px;
            overflow:hidden;
            min-width:200px;
            border:1px solid #e5e7eb;
        }

        .dropdown:hover .dropdown-menu {
            display:block;
        }

        .dropdown-menu a,
        .dropdown-menu span {
            display:block;
            padding:10px 14px;
            text-decoration:none;
            color:#111827;
            white-space:nowrap;
            font-size:14px;
            font-weight:500;
        }

        .dropdown-menu a:hover {
            background:#f7faf7;
        }

        /* Layout */
        .container {
            max-width:1200px;
            margin:24px auto 36px;
            padding:0 4%;
        }

        .cart-grid {
            display:grid;
            grid-template-columns:1fr 340px;
            gap:24px;
            align-items:flex-start;
        }

        @media (max-width:900px) {
            .cart-grid {
                grid-template-columns:1fr;
            }
        }

        /* Cards */
        .card {
            background:#fff;
            border-radius:16px;
            padding:20px;
            box-shadow:0 10px 30px var(--ring);
            border:1px solid rgba(209,213,219,0.8);
        }

        /* Cart area */
        .cart-items-container {
            background:#fff;
            border-radius:16px;
            padding:20px;
            box-shadow:0 10px 30px var(--ring);
            border:1px solid rgba(209,213,219,0.8);
        }

        .cart-header {
            display:flex;
            justify-content:space-between;
            align-items:baseline;
            border-bottom:1px solid #e5e7eb;
            padding-bottom:10px;
            margin-bottom:6px;
        }

        .cart-header h1 {
            font-size:24px;
            margin:0;
            color:var(--dark);
        }

        .cart-header a {
            font-size:13px;
            color:var(--green);
            text-decoration:none;
        }

        .cart-header a:hover {
            text-decoration:underline;
        }

        /* Gift card image shimmer */
        @keyframes shimmer {
            0% { background-position:-200px 0; }
            100% { background-position:200px 0; }
        }

        .giftcard-img {
            width:150px;
            height:150px;
            object-fit:contain;
            border-radius:12px;
            border:1px solid #f5c07a;
            padding:6px;
            box-shadow:0 3px 10px rgba(0,0,0,0.15);
            background:#fff linear-gradient(
                    110deg,
                    #fff8e1 25%,
                    #fff3cd 37%,
                    #fff8e1 63%
            );
            background-size:400% 100%;
            animation:shimmer 2s infinite linear;
            transition:transform .25s ease, box-shadow .25s ease;
        }

        .giftcard-img:hover {
            transform:scale(1.04);
            box-shadow:0 6px 16px rgba(183,65,14,0.3);
        }

        .cart-item-card {
            display:flex;
            gap:16px;
            padding:18px 0;
            border-bottom:1px solid #e5e7eb;
        }

        .cart-item-card:last-child {
            border-bottom:none;
        }

        .item-image {
            flex-shrink:0;
            display:flex;
            align-items:flex-start;
            gap:14px;
        }

        .item-image img {
            width:150px;
            height:150px;
            object-fit:contain;
            border-radius:10px;
            box-shadow:0 2px 8px rgba(0,0,0,0.05);
        }

        .item-details {
            flex-grow:1;
        }

        .item-details h3 {
            margin:0 0 6px;
            font-size:17px;
            font-weight:700;
            color:#111827;
        }

        .small-muted {
            color:#6b7280;
            font-size:13px;
        }

        .weight-pill {
            display:inline-block;
            margin-top:6px;
            background:#eef6f0;
            border:1px solid #d7eadf;
            color:#166534;
            padding:2px 10px;
            border-radius:999px;
            font-weight:600;
            font-size:11px;
        }

        .item-stock {
            color:var(--green);
            font-size:13px;
            font-weight:600;
            margin:10px 0 4px;
        }

        .item-actions-toolbar {
            display:flex;
            flex-wrap:wrap;
            align-items:center;
            gap:10px;
            margin-top:8px;
            font-size:13px;
        }

        .btn-action {
            background:#f9fafb;
            color:#374151;
            border:1px solid #d1d5db;
            padding:7px 11px;
            border-radius:999px;
            cursor:pointer;
            font-size:12px;
            font-weight:600;
        }

        .btn-action:hover {
            background:#f3f4f6;
        }

        .separator {
            color:#d1d5db;
        }

        .item-price {
            font-size:17px;
            font-weight:700;
            color:var(--accent);
            text-align:right;
            min-width:80px;
        }

        /* Qty selector */
        .quantity-selector {
            display:flex;
            align-items:center;
            border:1px solid #d1d5db;
            border-radius:999px;
            overflow:hidden;
            background:#f9fafb;
        }

        .quantity-selector button {
            background:#eef2f7;
            border:none;
            padding:6px 10px;
            cursor:pointer;
            font-size:14px;
            font-weight:600;
        }

        .quantity-selector button:hover {
            background:#e5e7eb;
        }

        .quantity-selector .qty-btn-minus {
            border-right:1px solid #d1d5db;
        }

        .quantity-selector .qty-btn-plus {
            border-left:1px solid #d1d5db;
        }

        .quantity-selector input {
            width:50px;
            text-align:center;
            border:none;
            font-size:14px;
            background:transparent;
            -moz-appearance:textfield;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance:none;
            margin:0;
        }

        .cart-subtotal-footer {
            text-align:right;
            font-size:15px;
            margin-top:16px;
            font-weight:500;
        }

        .cart-subtotal-footer strong {
            font-size:16px;
        }

        /* Summary */
        .summary-card {
            background:#fff;
            border-radius:16px;
            box-shadow:0 10px 30px var(--ring);
            padding:18px 18px 20px;
            border:1px solid rgba(209,213,219,0.85);
            position:sticky;
            top:84px;
        }

        .summary-card h2 {
            font-size:17px;
            margin:0 0 10px;
            color:#111827;
        }

        .row {
            display:flex;
            justify-content:space-between;
            margin:6px 0;
            font-size:14px;
        }

        .row.total {
            font-size:16px;
            font-weight:800;
            margin-top:10px;
        }

        .btn-checkout {
            display:block;
            width:100%;
            text-align:center;
            background:linear-gradient(90deg, #22c55e, #16a34a);
            color:#fff;
            padding:11px 16px;
            border-radius:999px;
            text-decoration:none;
            font-weight:700;
            font-size:15px;
            border:none;
            margin-top:14px;
            box-shadow:0 10px 24px rgba(22,163,74,0.4);
            cursor:pointer;
        }

        .btn-checkout:hover {
            box-shadow:0 14px 32px rgba(22,163,74,0.5);
            transform:translateY(-1px);
        }

        /* Empty state */
        .empty {
            background:#fff;
            border-radius:16px;
            padding:28px 20px;
            text-align:center;
            box-shadow:0 10px 30px var(--ring);
            border:1px solid rgba(209,213,219,0.8);
        }

        .empty p {
            margin:12px 0 6px;
            font-size:15px;
        }

        .shop-link {
            display:inline-flex;
            align-items:center;
            gap:8px;
            margin-top:6px;
            color:#fff;
            background:var(--green);
            padding:10px 16px;
            border-radius:999px;
            text-decoration:none;
            font-weight:700;
            font-size:14px;
            box-shadow:0 10px 22px rgba(34,197,94,0.3);
        }

        .shop-link:hover {
            background:var(--accent);
            box-shadow:0 12px 26px rgba(183,65,14,0.4);
        }

        /* Tabs */
        .tabs {
            display:flex;
            border-bottom:1px solid #e5e7eb;
            margin:18px 0 18px;
            gap:6px;
        }

        .tab-link {
            padding:8px 14px;
            text-decoration:none;
            color:#6b7280;
            font-weight:600;
            border-radius:999px 999px 0 0;
            border-bottom:2px solid transparent;
            font-size:14px;
            display:inline-flex;
            align-items:center;
            gap:6px;
        }

        .tab-link span.badge-pill {
            background:#e5f4ea;
            border-radius:999px;
            padding:2px 7px;
            font-size:11px;
            font-weight:700;
            color:#166534;
        }

        .tab-link:hover {
            color:var(--green);
        }

        .tab-link.active {
            color:var(--green);
            border-bottom-color:var(--green);
            background:#f3faf5;
        }

        .tab-content {
            display:none;
        }

        .tab-content.active {
            display:block;
        }

        /* Footer */
        .site-footer {
            background:#111827;
            color:#9ca3af;
            padding:40px 6% 26px;
            margin-top:40px;
        }

        .footer-container {
            display:flex;
            flex-wrap:wrap;
            justify-content:space-between;
            gap:30px;
            margin-bottom:30px;
        }

        .footer-column {
            flex:1;
            min-width:220px;
        }

        .footer-column h3 {
            color:#f9fafb;
            margin-bottom:14px;
            font-weight:600;
            border-bottom:2px solid var(--green);
            padding-bottom:6px;
            display:inline-block;
            font-size:15px;
        }

        .footer-column p {
            line-height:1.6;
            font-size:14px;
        }

        .footer-column ul {
            list-style:none;
            padding:0;
            margin:0;
        }

        .footer-column ul li a {
            text-decoration:none;
            color:#9ca3af;
            display:block;
            padding:5px 0;
            font-size:14px;
            transition:color .2s ease, transform .1s ease;
        }

        .footer-column ul li a:hover {
            color:#e5e7eb;
            transform:translateX(2px);
        }

        .social-links a {
            color:#9ca3af;
            text-decoration:none;
            font-size:20px;
            margin-right:16px;
            transition:color .2s ease, transform .1s ease;
        }

        .social-links a:hover {
            color:var(--green);
            transform:translateY(-1px);
        }

        .footer-bottom {
            text-align:center;
            padding-top:18px;
            border-top:1px solid #1f2937;
            font-size:13px;
            color:#6b7280;
        }

        @media (max-width:768px) {
            .navbar {
                flex-wrap:wrap;
            }

            .nav-search {
                order:3;
                width:100%;
                max-width:none;
            }

            .footer-container {
                flex-direction:column;
                text-align:left;
            }

            .footer-column {
                margin-bottom:12px;
            }
        }

        @media (max-width:640px) {
            .cart-header h1 {
                font-size:22px;
            }

            .cart-item-card {
                flex-direction:column;
                align-items:flex-start;
            }

            .item-price {
                text-align:left;
            }
        }
    </style>
</head>
<body>

<nav class="navbar">
    <a href="/" class="brand-logo">
        <video src="/images/Spice-Jar.mp4" autoplay muted loop playsinline></video>
        <span>SpiceJar</span>
    </a>

    <form class="nav-search" role="search" onsubmit="return false;">
        <input id="nav-q" type="search" placeholder="Search spices‚Ä¶" aria-label="Search" th:value="${q}">
        <button id="nav-search-btn" type="button" aria-label="Search">
            <i class="fa-solid fa-magnifying-glass"></i>
        </button>
    </form>

    <div class="nav-links">
        <a th:href="@{/menu}">Menu</a>
        <a th:href="@{/about}">About Us</a>
        <a class="nav-link" th:href="@{/cart/view}">
            <div class="cart-icon-container" aria-live="polite" aria-label="Cart items">
                <i class="fas fa-shopping-cart" style="font-size:20px"></i>
                <span class="cart-count-badge" id="lblCartCount" th:text="${cartCount}">0</span>
            </div>
        </a>
        <a th:href="@{/contact}">Contact Us</a>

        <div class="dropdown">
            <button class="dropdown-toggle" type="button">
                <i class="fas fa-user"></i>
                <span th:text="${session.USER != null ? session.USER.firstName : 'Account'}">Account</span>
            </button>
            <div class="dropdown-menu">
                <a th:if="${session.USER == null}" th:href="@{/login}">Login</a>
                <a th:if="${session.USER == null}" th:href="@{/register}">Register</a>
                <span th:if="${session.USER != null}">
                    Welcome, <strong th:text="${session.USER.firstName}">User</strong>
                </span>
                <a th:if="${session.USER != null}" th:href="@{/account}">Your Account</a>
                <a th:if="${session.USER != null}" th:href="@{/orders}">My Orders</a>
                <a th:if="${session.USER != null}" th:href="@{/logout}">Logout</a>
            </div>
        </div>
    </div>
</nav>

<div class="container">

    <!-- Empty -->
    <div class="empty"
         th:if="${(cart == null or cart.items == null or #lists.isEmpty(cart.items)) and
               (cart == null or cart.savedForLater == null or #lists.isEmpty(cart.savedForLater))}">
        <i class="fa-solid fa-bag-shopping" style="font-size:36px;color:var(--green)"></i>
        <p>Your cart is empty.</p>
        <a class="shop-link" th:href="@{/menu}">
            <i class="fa-solid fa-store"></i>
            Browse Menu
        </a>
    </div>

    <!-- Tabs only when we have something -->
    <div th:if="${cart != null and ( (cart.items != null and !#lists.isEmpty(cart.items)) or
                                   (cart.savedForLater != null and !#lists.isEmpty(cart.savedForLater)) )}">
        <div class="tabs">
            <a href="#" class="tab-link active" data-tab="cart-tab">
                Shopping Cart
                (<span id="cartCountSpan" class="badge-pill" th:text="${cart.items.size()}">0</span>)
            </a>
            <a href="#" class="tab-link" data-tab="saved-tab">
                Saved for later
                (<span id="savedCountSpan" class="badge-pill" th:text="${cart.savedForLater.size()}">0</span>)
            </a>
        </div>
    </div>

    <!-- Cart tab -->
    <div id="cart-tab-content" class="tab-content active">
        <div th:if="${cart != null and cart.items != null and !#lists.isEmpty(cart.items)}">
            <div class="cart-grid">
                <!-- Items -->
                <main class="cart-items-container">
                    <div class="cart-header">
                        <h1>Shopping Cart</h1>
                        <a href="#">Deselect all items</a>
                    </div>

                    <div th:each="it : ${cart.items}" class="cart-item-card">
                        <div class="item-image">
                            <input type="checkbox" checked/>

                            <!-- Gift card image -->
                            <img th:if="${it.name == 'SpiceJar email gift card' and it.description == 'Gift card for Althaf'}"
                                 src="/images/spicejar-giftcard.png"
                                 alt="Spice Jar Gift Card"
                                 class="giftcard-img"/>

                            <!-- Default product image -->
                            <img th:if="${!(it.name == 'SpiceJar email gift card' and it.description == 'Gift card for Althaf')}"
                                 th:src="${#strings.isEmpty(it.imageUrl) ? '/images/chilli%20powder.jpeg' : it.imageUrl}"
                                 alt="Product Image"/>
                        </div>

                        <div class="item-details">
                            <div th:if="${it.name == 'SpiceJar email gift card' and it.description == 'Gift card for Althaf'}"
                                 style="background:#fff8e1;color:#b7410e;font-weight:700;
                                        border-radius:8px;padding:4px 10px;display:inline-block;
                                        margin-bottom:8px;">
                                üéÅ Spice Jar Gift Card
                            </div>

                            <h3 th:text="${it.name}">Product name</h3>

                            <div class="small-muted" th:if="${it.description != null}" th:text="${it.description}">
                                Product short description.
                            </div>

                            <span class="weight-pill" th:if="${it.weightGrams != null}"
                                  th:text="${it.weightGrams} + ' g'">500 g</span>

                            <div class="item-stock">In Stock</div>

                            <div class="item-actions-toolbar">
                                <form th:action="@{/cart/update}" method="post"
                                      class="quantity-form" style="display:inline-flex;align-items:center;gap:10px">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                    <input type="hidden" name="productId" th:value="${it.productId}"/>
                                    <div class="quantity-selector">
                                        <button type="button" class="qty-btn-minus"
                                                th:attr="data-product-id=${it.productId}">-</button>
                                        <input type="number" name="qty" th:value="${it.qty}" min="1" class="qty-input"
                                               th:id="'qty-input-' + ${it.productId}"/>
                                        <button type="button" class="qty-btn-plus"
                                                th:attr="data-product-id=${it.productId}">+</button>
                                    </div>
                                </form>

                                <span class="separator">|</span>

                                <form th:action="@{/cart/update}" method="post" style="display:inline">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                    <input type="hidden" name="productId" th:value="${it.productId}"/>
                                    <input type="hidden" name="qty" value="0"/>
                                    <button type="submit" class="btn-action">Delete</button>
                                </form>

                                <span class="separator">|</span>

                                <form th:action="@{/cart/saveForLater}" method="post" style="display:inline">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                    <input type="hidden" name="productId" th:value="${it.productId}"/>
                                    <button type="submit" class="btn-action">Save for later</button>
                                </form>

                                <span class="separator">|</span>
                                <a th:href="@{/menu}" class="small-muted">Compare with similar items</a>
                            </div>
                        </div>

                        <!-- Price (safe rendering) -->
                        <div class="item-price" th:if="${it != null && it.price != null}">
                            $ <span th:text="${#numbers.formatDecimal(it.price,1,'COMMA',2,'POINT')}">0.00</span>
                        </div>
                        <div class="item-price" th:if="${it == null || it.price == null}">
                            $ 0.00
                        </div>
                    </div>

                    <div class="cart-subtotal-footer">
                        Subtotal (<span th:text="${cart.items.size()}">0</span> items):
                        <strong th:text="${#numbers.formatDecimal(cart.subtotal,1,'COMMA',2,'POINT')}">$0.00</strong>
                    </div>
                </main>

                <!-- Summary -->
                <aside class="summary-card">
                    <h2>Order summary</h2>
                    <div class="row">
                        <span>Items</span>
                        <span th:text="${cart.items.size()}">0</span>
                    </div>
                    <div class="row">
                        <span>Subtotal</span>
                        <span th:text="${#numbers.formatDecimal(cart.subtotal,1,'COMMA',2,'POINT')}">$0.00</span>
                    </div>
                    <div class="row">
                        <span>Tax (8%)</span>
                        <span th:text="${#numbers.formatDecimal(cart.tax,1,'COMMA',2,'POINT')}">$0.00</span>
                    </div>
                    <div class="row total">
                        <span>Total</span>
                        <span th:text="${#numbers.formatDecimal(cart.grandTotal,1,'COMMA',2,'POINT')}">$0.00</span>
                    </div>
                    <a class="btn-checkout" th:href="@{/order/checkout}">
                        <i class="fa-solid fa-credit-card"></i> Proceed to checkout
                    </a>
                </aside>
            </div>
        </div>
    </div>

    <!-- Saved tab -->
    <div id="saved-tab-content" class="tab-content">
        <div th:if="${cart != null and cart.savedForLater != null and !#lists.isEmpty(cart.savedForLater)}">
            <main class="cart-items-container">
                <div class="cart-header">
                    <h1>Saved for later</h1>
                    <a href="#">Deselect all items</a>
                </div>

                <div th:each="it : ${cart.savedForLater}" class="cart-item-card">
                    <div class="item-image">
                        <input type="checkbox" checked/>
                        <img th:src="${#strings.isEmpty(it.imageUrl) ? '/images/chilli%20powder.jpeg' : it.imageUrl}"
                             alt="Product Image"/>
                    </div>

                    <div class="item-details">
                        <h3 th:text="${it.name}">Product name</h3>

                        <div class="small-muted" th:if="${it.description != null}" th:text="${it.description}">
                            Product short description.
                        </div>
                        <span class="weight-pill" th:if="${it.weightGrams != null}"
                              th:text="${it.weightGrams} + ' g'">500 g</span>

                        <div class="item-stock">In Stock</div>

                        <div class="item-actions-toolbar">
                            <form th:action="@{/cart/moveToCart}" method="post" style="display:inline">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <input type="hidden" name="productId" th:value="${it.productId}"/>
                                <button type="submit" class="btn-action">Move to cart</button>
                            </form>
                        </div>
                    </div>

                    <div class="item-price">
                        $ <span th:text="${#numbers.formatDecimal(it.price,1,'COMMA',2,'POINT')}">0.00</span>
                    </div>
                </div>
            </main>
        </div>
    </div>

</div>

<footer class="site-footer">
    <div class="footer-container">
        <div class="footer-column">
            <h3>About Spice Jar</h3>
            <p>Bringing the world's finest spices to your kitchen. Quality, aroma, and flavor guaranteed in every jar.</p>
        </div>
        <div class="footer-column">
            <h3>Quick Links</h3>
            <ul>
                <li><a th:href="@{/menu}">Menu</a></li>
                <li><a th:href="@{/about}">About Us</a></li>
                <li><a th:href="@{/contact}">Contact</a></li>
                <li><a href="#">FAQ</a></li>
            </ul>
        </div>
        <div class="footer-column">
            <h3>Connect With Us</h3>
            <div class="social-links">
                <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                <a href="#" aria-label="Pinterest"><i class="fab fa-pinterest"></i></a>
            </div>
        </div>
    </div>
    <div class="footer-bottom">
        <p>&copy; 2025 The Spice Jar. All rights reserved.</p>
    </div>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // qty buttons -> submit form
        document.querySelectorAll('.qty-btn-minus').forEach(btn => {
            btn.addEventListener('click', () => {
                const id = btn.dataset.productId;
                const input = document.getElementById(`qty-input-${id}`);
                if (!input) return;
                const val = Math.max(0, parseInt(input.value || '1', 10) - 1);
                input.value = val;
                input.closest('form').submit();
            });
        });

        document.querySelectorAll('.qty-btn-plus').forEach(btn => {
            btn.addEventListener('click', () => {
                const id = btn.dataset.productId;
                const input = document.getElementById(`qty-input-${id}`);
                if (!input) return;
                input.value = (parseInt(input.value || '0', 10) + 1);
                input.closest('form').submit();
            });
        });

        // debounce manual change
        document.querySelectorAll('.qty-input').forEach(input => {
            let t;
            input.addEventListener('change', () => {
                clearTimeout(t);
                t = setTimeout(() => input.closest('form').submit(), 400);
            });
        });

        // tabs
        const links = document.querySelectorAll('.tab-link');
        if (links.length > 0) {
            const cartCountSpan = document.getElementById('cartCountSpan');
            const savedCountSpan = document.getElementById('savedCountSpan');
            const cartCount = cartCountSpan ? cartCountSpan.textContent.trim() : '0';
            const savedCount = savedCountSpan ? savedCountSpan.textContent.trim() : '0';

            function show(tab) {
                document.getElementById('cart-tab-content').classList.toggle('active', tab === 'cart');
                document.getElementById('saved-tab-content').classList.toggle('active', tab === 'saved');
                links.forEach(l => {
                    const isCart = l.dataset.tab === 'cart-tab';
                    l.classList.toggle('active', (tab === 'cart' && isCart) || (tab === 'saved' && !isCart));
                });
            }

            links.forEach(l => l.addEventListener('click', e => {
                e.preventDefault();
                show(l.dataset.tab === 'cart-tab' ? 'cart' : 'saved');
            }));

            if (cartCount !== '0') {
                show('cart');
            } else if (savedCount !== '0') {
                show('saved');
            }
        }
    });
</script>

</body>
</html>
